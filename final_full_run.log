
======================================
SETUP
======================================

[14:59:38] Using base URL: http://localhost:8000
[14:59:38] Waiting for: orchestrator health endpoint (timeout 60s)
[0;32m[14:59:43] âœ“ Condition met after 0s[0m
[0;32m[14:59:54] âœ“ Health endpoint reports healthy (expected=healthy, actual=healthy)[0m

======================================
STAGE 0: INFRASTRUCTURE
======================================

[14:59:54] Running test: infra_containers
[0;32m[14:59:54] âœ“ Container vib-orchestrator running (expected=true, actual=true)[0m
[0;32m[14:59:55] âœ“ Container vib-worker running (expected=true, actual=true)[0m
[0;32m[14:59:56] âœ“ Container vib-beat running (expected=true, actual=true)[0m
[0;32m[14:59:56] âœ“ Container vib-postgres running (expected=true, actual=true)[0m
[0;32m[14:59:57] âœ“ Container vib-redis running (expected=true, actual=true)[0m
[0;32m[14:59:57] âœ“ Container vib-qdrant running (expected=true, actual=true)[0m
[0;32m[14:59:57] âœ“ infra_containers passed (3s)[0m
[14:59:57] Running test: infra_health_status
[0;32m[15:00:03] âœ“ Health endpoint returns 200[0m
[0;32m[15:00:03] âœ“ Health status is healthy (expected=healthy, actual=healthy)[0m
[0;32m[15:00:03] âœ“ infra_health_status passed (6s)[0m
[15:00:03] Running test: infra_health_services
[0;32m[15:00:03] âœ“ Service postgres healthy (expected=ok, actual=ok)[0m
[0;32m[15:00:03] âœ“ Service redis healthy (expected=ok, actual=ok)[0m
[0;32m[15:00:03] âœ“ Service qdrant healthy (expected=ok, actual=ok)[0m
[0;32m[15:00:03] âœ“ Service celery_worker healthy (expected=ok, actual=ok)[0m
[0;32m[15:00:03] âœ“ infra_health_services passed (0s)[0m
[15:00:03] Running test: infra_metrics_endpoint
[0;32m[15:00:03] âœ“ Metrics endpoint returns 200[0m
[0;32m[15:00:03] âœ“ Metrics contain HELP blocks[0m
[0;32m[15:00:03] âœ“ infra_metrics_endpoint passed (0s)[0m
[15:00:03] Running test: infra_metrics_help
[0;32m[15:00:03] âœ“ api_request_duration_seconds metric present[0m
[0;32m[15:00:03] âœ“ infra_metrics_help passed (0s)[0m
[15:00:03] Running test: infra_database
[0;32m[15:00:04] âœ“ Database responds (expected=1, actual=1)[0m
[0;32m[15:00:04] âœ“ infra_database passed (1s)[0m
[15:00:04] Running test: infra_redis
[0;32m[15:00:05] âœ“ Redis responds (expected=PONG, actual=PONG)[0m
[0;32m[15:00:05] âœ“ infra_redis passed (1s)[0m
[15:00:05] Running test: infra_qdrant
[0;32m[15:00:05] âœ“ Qdrant collection available[0m
[0;32m[15:00:05] âœ“ infra_qdrant passed (0s)[0m
[15:00:05] Running test: infra_auth_valid
[0;32m[15:00:05] âœ“ Valid token accepted[0m
[0;32m[15:00:05] âœ“ infra_auth_valid passed (0s)[0m
[15:00:05] Running test: infra_auth_invalid
[0;32m[15:00:05] âœ“ Invalid token rejected[0m
[0;32m[15:00:05] âœ“ infra_auth_invalid passed (0s)[0m
[15:00:05] Running test: infra_auth_missing
[0;32m[15:00:06] âœ“ Missing token rejected[0m
[0;32m[15:00:06] âœ“ infra_auth_missing passed (0s)[0m
[15:00:06] Running test: infra_rate_limit
[0;32m[15:00:09] âœ“ Rate limit triggered (2/32 responses were rate-limited)[0m
[0;32m[15:00:09] âœ“ infra_rate_limit passed (3s)[0m
[15:00:09] Running test: infra_rate_limit_reset
[15:00:09] Waiting 65s for rate limit window to reset
[0;32m[15:01:14] âœ“ Requests succeed after window reset (expected=200, actual=200)[0m
[0;32m[15:01:14] âœ“ infra_rate_limit_reset passed (65s)[0m
[15:01:14] Running test: infra_logs
[0;32m[15:01:14] âœ“ Logs contain timestamp[0m
[0;32m[15:01:14] âœ“ Logs contain endpoint/event[0m
[0;32m[15:01:15] âœ“ infra_logs passed (0s)[0m
[15:01:15] Running test: infra_metrics_increment
[0;32m[15:01:15] âœ“ Metrics updated after request[0m
[0;32m[15:01:15] âœ“ infra_metrics_increment passed (0s)[0m
[15:01:15] Running test: infra_cors
[0;32m[15:01:20] âœ“ CORS header present[0m
[0;32m[15:01:20] âœ“ infra_cors passed (5s)[0m
[15:01:20] Running test: infra_tls
[1;33m[15:01:20] âš  BASE_URL not HTTPS; skipping TLS check[0m
[0;32m[15:01:20] âœ“ infra_tls passed (0s)[0m
[15:01:20] Running test: infra_celery_worker
[0;32m[15:01:33] âœ“ Celery worker responding[0m
[0;32m[15:01:33] âœ“ infra_celery_worker passed (13s)[0m
[15:01:33] Running test: infra_celery_beat
[0;32m[15:01:33] âœ“ Celery beat running[0m
[0;32m[15:01:33] âœ“ infra_celery_beat passed (0s)[0m
[15:01:33] Running test: infra_db_schema
[0;32m[15:01:34] âœ“ DB schema migrated (23 > 10)[0m
[0;32m[15:01:34] âœ“ infra_db_schema passed (1s)[0m
[15:01:34] Running test: infra_metrics_prom
[0;32m[15:01:34] âœ“ Reminder lag histogram exposed[0m
[0;32m[15:01:34] âœ“ infra_metrics_prom passed (0s)[0m
[15:01:34] Running test: infra_qdrant_metric
[0;32m[15:01:34] âœ“ Qdrant gauge exported[0m
[0;32m[15:01:34] âœ“ infra_qdrant_metric passed (0s)[0m

======================================
STAGE 1: NOTES + VECTOR SEARCH
======================================

[15:01:34] Running test: notes_api_create
[0;32m[15:01:35] âœ“ Note created via API[0m
[0;32m[15:01:35] âœ“ notes_api_create passed (1s)[0m
[15:01:35] Running test: notes_db_record
[0;32m[15:01:36] âœ“ Note persisted in DB (expected=1, actual=1)[0m
[0;32m[15:01:36] âœ“ notes_db_record passed (1s)[0m
[15:01:36] Running test: notes_markdown
[0;32m[15:01:36] âœ“ Markdown file created[0m
[0;32m[15:01:36] âœ“ notes_markdown passed (0s)[0m
[15:01:36] Running test: notes_frontmatter
[0;32m[15:01:36] âœ“ Frontmatter has title[0m
[0;32m[15:01:36] âœ“ Frontmatter has tags[0m
[0;32m[15:01:36] âœ“ notes_frontmatter passed (0s)[0m
[15:01:36] Running test: notes_embedding
[15:01:36] Waiting for: note embedding state (timeout 90s)
[0;32m[15:01:37] âœ“ Condition met after 0s[0m
[0;32m[15:01:37] âœ“ notes_embedding passed (1s)[0m
[15:01:37] Running test: notes_vector_keyword
[0;32m[15:01:46] âœ“ Keyword search finds note[0m
[0;32m[15:01:46] âœ“ notes_vector_keyword passed (9s)[0m
[15:01:46] Running test: notes_vector_semantic
[0;32m[15:01:47] âœ“ Semantic search returns note[0m
[0;32m[15:01:47] âœ“ notes_vector_semantic passed (1s)[0m
[15:01:47] Running test: notes_top3
[0;32m[15:01:47] âœ“ Search returns <=3 results (3 < 4)[0m
[0;32m[15:01:47] âœ“ notes_top3 passed (0s)[0m
[15:01:47] Running test: notes_filter
[0;32m[15:01:47] âœ“ Search filter content_type=note yields results (10 > 0)[0m
[0;32m[15:01:47] âœ“ notes_filter passed (0s)[0m
[15:01:47] Running test: notes_user_scope
[0;32m[15:01:48] âœ“ Results scoped to user[0m
[0;32m[15:01:48] âœ“ notes_user_scope passed (1s)[0m
[15:01:48] Running test: notes_dedup_response
[0;32m[15:01:48] âœ“ Duplicate creation flagged (expected=true, actual=true)[0m
[0;32m[15:01:48] âœ“ notes_dedup_response passed (0s)[0m
[15:01:48] Running test: notes_dedup_message
[0;32m[15:01:48] âœ“ Deduplication message returned[0m
[0;32m[15:01:48] âœ“ notes_dedup_message passed (0s)[0m
[15:01:48] Running test: notes_db_constraint
[0;32m[15:01:49] âœ“ DB constraint blocked duplicate[0m
[0;32m[15:01:49] âœ“ notes_db_constraint passed (1s)[0m
[15:01:49] Running test: notes_slug_simple
[0;32m[15:01:50] âœ“ Slugified filename[0m
[0;32m[15:01:50] âœ“ notes_slug_simple passed (1s)[0m
[15:01:50] Running test: notes_slug_special
[0;32m[15:01:50] âœ“ Special chars sanitized[0m
[0;32m[15:01:50] âœ“ notes_slug_special passed (0s)[0m
[15:01:50] Running test: notes_slug_collision
[0;32m[15:01:50] âœ“ Slug collision resolved with suffix[0m
[0;32m[15:01:52] âœ“ notes_slug_collision passed (2s)[0m
[15:01:52] Running test: notes_file_sync
[0;32m[15:01:52] âœ“ file_sync_state entry exists (expected=1, actual=1)[0m
[0;32m[15:01:52] âœ“ notes_file_sync passed (0s)[0m
[15:01:52] Running test: notes_external_edit
[15:01:53] Waiting for: re-embedding after external edit (timeout 180s)
[0;31m[15:06:48] âœ— Timeout waiting for: re-embedding after external edit[0m
[0;32m[15:06:49] âœ“ Embedding timestamp advanced (1763132519.251385 > 1763132495.189934)[0m
[0;32m[15:06:49] âœ“ notes_external_edit passed (297s)[0m
[15:06:49] Running test: notes_chat_create
[0;32m[15:06:51] âœ“ Chat endpoint responded[0m
[0;32m[15:06:51] âœ“ Chat note mode returned (expected=note, actual=note)[0m
[0;32m[15:06:51] âœ“ Chat note ID present[0m
[0;32m[15:06:53] âœ“ notes_chat_create passed (4s)[0m
[15:06:53] Running test: notes_chat_search
[0;32m[15:06:53] âœ“ Chat search endpoint responded[0m
[0;32m[15:06:53] âœ“ Chat search mode returned (expected=search, actual=search)[0m
[0;32m[15:06:53] âœ“ Chat search returned results (5 > 0)[0m
[0;32m[15:06:53] âœ“ notes_chat_search passed (0s)[0m
[15:06:53] Running test: notes_list_endpoint
[0;32m[15:06:53] âœ“ List notes endpoint[0m
[0;32m[15:06:53] âœ“ notes_list_endpoint passed (0s)[0m
[15:06:53] Running test: notes_update_endpoint
[0;32m[15:06:54] âœ“ Patch note works[0m
[0;32m[15:06:54] âœ“ notes_update_endpoint passed (1s)[0m

======================================
STAGE 2: REMINDERS + NOTIFICATIONS
======================================

[15:06:54] Running test: reminder_api_create
[0;32m[15:06:54] âœ“ Reminder created via API[0m
[0;32m[15:06:54] âœ“ reminder_api_create passed (0s)[0m
[15:06:54] Running test: reminder_db_record
[0;32m[15:06:55] âœ“ Reminder persisted in DB (expected=1, actual=1)[0m
[0;32m[15:06:55] âœ“ reminder_db_record passed (1s)[0m
[15:06:55] Running test: reminder_scheduler_entry
[0;32m[15:06:56] âœ“ Reminder ad50f51e-3cc0-481a-af2d-d01646d8bf88 scheduled in APScheduler[0m
[0;32m[15:06:56] âœ“ reminder_scheduler_entry passed (1s)[0m
[15:06:56] Running test: reminder_chat_flow
[0;32m[15:06:56] âœ“ Chat endpoint accepted reminder request[0m
[0;32m[15:06:56] âœ“ reminder_chat_flow passed (0s)[0m
[15:06:56] Running test: reminder_smart_defaults
[0;32m[15:06:56] âœ“ Chat request for smart defaults[0m
[0;32m[15:07:02] âœ“ Reminder created via chat[0m
[0;32m[15:07:03] âœ“ Smart default produced local time 09:00:00[0m
[0;32m[15:07:03] âœ“ reminder_smart_defaults passed (7s)[0m
[15:07:03] Running test: reminder_dedup_response
[0;32m[15:07:03] âœ“ Duplicate reminder flagged (expected=true, actual=true)[0m
[0;32m[15:07:03] âœ“ reminder_dedup_response passed (0s)[0m
[15:07:03] Running test: reminder_dedup_constraint
[0;32m[15:07:03] âœ“ Database prevented duplicate reminder[0m
[0;32m[15:07:04] âœ“ reminder_dedup_constraint passed (0s)[0m
[15:07:04] Running test: reminder_timezone
[0;32m[15:07:04] âœ“ Timezone stored correctly (expected=America/Los_Angeles, actual=America/Los_Angeles)[0m
[0;32m[15:07:04] âœ“ reminder_timezone passed (0s)[0m
[15:07:04] Running test: reminder_due_local
[0;32m[15:07:05] âœ“ due_at_local preserved (expected=15:36:00, actual=15:36:00)[0m
[0;32m[15:07:05] âœ“ reminder_due_local passed (1s)[0m
[15:07:05] Running test: reminder_snooze_updates
[0;32m[15:07:07] âœ“ Snooze returned due_at[0m
[0;32m[15:07:07] âœ“ reminder_snooze_updates passed (2s)[0m
[15:07:07] Running test: reminder_snooze_logs
[0;32m[15:07:08] âœ“ Snooze reschedule logged[0m
[0;32m[15:07:08] âœ“ reminder_snooze_logs passed (1s)[0m
[15:07:08] Running test: reminder_cancel_endpoint
[0;32m[15:07:08] âœ“ Cancel endpoint[0m
[0;32m[15:07:08] âœ“ reminder_cancel_endpoint passed (0s)[0m
[15:07:08] Running test: reminder_cancel_state
[1;33m[15:07:09] âš  Base reminder not cancelled; cancelling now[0m
[0;32m[15:07:10] âœ“ Reminder marked cancelled (expected=cancelled, actual=cancelled)[0m
[0;32m[15:07:10] âœ“ reminder_cancel_state passed (2s)[0m
[15:07:10] Running test: reminder_recurring_daily
[0;32m[15:07:11] âœ“ Daily recurrence saved (expected=FREQ=DAILY, actual=FREQ=DAILY)[0m
[0;32m[15:07:11] âœ“ reminder_recurring_daily passed (1s)[0m
[15:07:11] Running test: reminder_recurring_weekly
[0;32m[15:07:12] âœ“ Weekly recurrence saved (expected=FREQ=WEEKLY;BYDAY=MO, actual=FREQ=WEEKLY;BYDAY=MO)[0m
[0;32m[15:07:12] âœ“ reminder_recurring_weekly passed (1s)[0m
[15:07:12] Running test: reminder_recurring_monthly
[0;32m[15:07:13] âœ“ Monthly recurrence saved (expected=FREQ=MONTHLY;BYMONTHDAY=1, actual=FREQ=MONTHLY;BYMONTHDAY=1)[0m
[0;32m[15:07:13] âœ“ reminder_recurring_monthly passed (1s)[0m
[15:07:13] Running test: device_registration
[0;32m[15:07:13] âœ“ Device registered[0m
[0;32m[15:07:13] âœ“ device_registration passed (0s)[0m
[15:07:13] Running test: device_db_entry
[0;32m[15:07:14] âœ“ Device row exists (expected=1, actual=1)[0m
[0;32m[15:07:14] âœ“ device_db_entry passed (1s)[0m
[15:07:14] Running test: device_test_notification
[0;32m[15:07:14] âœ“ Test notification endpoint[0m
[0;32m[15:07:14] âœ“ device_test_notification passed (0s)[0m
[15:07:14] Running test: push_metrics
[1;33m[15:07:14] âš  Push delivery metrics have no samples[0m
[0;32m[15:07:14] âœ“ push_metrics passed (0s)[0m
[15:07:14] Running test: reminder_fire_slo
[15:07:14] Waiting for reminder f6ebb630-1969-4574-bce3-066c70fad5bc to fire (up to 150s)
[15:07:14] Waiting for: notification delivery for f6ebb630-1969-4574-bce3-066c70fad5bc (timeout 150s)
[0;31m[15:11:20] âœ— Timeout waiting for: notification delivery for f6ebb630-1969-4574-bce3-066c70fad5bc[0m
[0;31m[15:11:20] âœ— reminder_fire_slo failed[0m
